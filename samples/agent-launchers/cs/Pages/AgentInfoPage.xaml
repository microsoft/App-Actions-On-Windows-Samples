<Page x:Class="SampleAgentLauncher.Pages.AgentInfoPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:SampleAgentLauncher.Pages"
      xmlns:vm="using:SampleAgentLauncher.ViewModels">

    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="20" Margin="0,0,0,20">
            <Button x:Name="BackButton" Click="BackButton_Click" VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE72B;" FontSize="14"/>
                    <TextBlock Text="Back"/>
                </StackPanel>
            </Button>
            <TextBlock Text="Agent Info Command Outputs"
                       FontSize="24"
                       FontWeight="Bold"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Refresh Button -->
        <Button Grid.Row="1"
                Command="{x:Bind ViewModel.RefreshAllCommand}"
                IsEnabled="{x:Bind InvertBool(ViewModel.IsRefreshing), Mode=OneWay}"
                Margin="0,0,0,20">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <FontIcon Glyph="&#xE72C;" FontSize="14"/>
                <TextBlock Text="Refresh All"/>
            </StackPanel>
        </Button>

        <!-- Command Results List -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{x:Bind ViewModel.CommandResults, Mode=OneWay}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:AgentInfoCommandResult">
                        <Expander Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                  BorderThickness="1"
                                  CornerRadius="8"
                                  IsExpanded="False"
                                  HorizontalAlignment="Stretch"
                                  HorizontalContentAlignment="Stretch"
                                  Margin="0,0,0,10">
                            <Expander.Header>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0" Orientation="Vertical" Spacing="4">
                                        <TextBlock Text="{x:Bind CommandDescription, Mode=OneWay}"
                                                   FontWeight="SemiBold"
                                                   FontSize="14"/>
                                        <TextBlock Text="{x:Bind Command, Mode=OneWay}"
                                                   FontFamily="Cascadia Code"
                                                   FontSize="12"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                        <!-- Loading indicator -->
                                        <ProgressRing IsActive="{x:Bind IsLoading, Mode=OneWay}"
                                                      Width="20"
                                                      Height="20"
                                                      Visibility="{x:Bind IsLoading, Mode=OneWay}"/>
                                        
                                        <!-- Error indicator -->
                                        <FontIcon Glyph="&#xE783;"
                                                  Foreground="Red"
                                                  FontSize="16"
                                                  Visibility="{x:Bind IsError, Mode=OneWay}"/>
                                        
                                        <!-- Success indicator -->
                                        <FontIcon Glyph="&#xE73E;"
                                                  Foreground="Green"
                                                  FontSize="16"
                                                  Visibility="{x:Bind IsSuccess, Mode=OneWay}"/>
                                    </StackPanel>
                                </Grid>
                            </Expander.Header>
                            
                            <ScrollViewer MaxHeight="300" 
                                          VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Auto"
                                          Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                <TextBlock Text="{x:Bind Output, Mode=OneWay}"
                                           TextWrapping="Wrap"
                                           Margin="12"
                                           FontFamily="Cascadia Code"
                                           FontSize="12"
                                           IsTextSelectionEnabled="True"/>
                            </ScrollViewer>
                        </Expander>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</Page>
